<section class="container-fluid py-4" style="background:#ffffff;">
  <div class="container">

    <!-- HERO -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="rounded-4 p-4 p-lg-5 d-flex flex-column flex-lg-row align-items-start align-items-lg-center border"
          style="background:#000; border-color:#111;">
          
          <div class="flex-grow-1 me-lg-5">
            <h1 class="h2 fw-bold mb-2 text-white">
              Repuestos diésel de alto rendimiento
            </h1>
            <p class="mb-3 text-white-50" style="max-width:520px;">
              Inyección, turbos y mantenimiento con envío a todo el país. Calidad profesional para tu motor.
            </p>

            <!-- BUSCADOR -->
            <div class="input-group input-group-lg mb-2">
              <input class="form-control border-0" 
                style="background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.3);"
                placeholder="Buscá por código o producto (ej: 0445110)"
                [(ngModel)]="q">
              <button class="btn fw-semibold text-white" style="background:#e60000;">
                Buscar
              </button>
            </div>

            <!-- Estados -->
            <div *ngIf="loading" class="mt-2 small text-white">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Buscando productos...
            </div>

            <div *ngIf="message" class="alert alert-danger mt-2 py-2 px-3 small mb-0">
              {{ message }}
            </div>

            <!-- FILTROS -->
            <div class="d-flex flex-wrap gap-2 mt-4">
              <button class="btn btn-sm btn-outline-light"
                [class.active]="onlyOffers"
                (click)="toggleOffers()">
                Solo ofertas
              </button>

              <button class="btn btn-sm btn-outline-light"
                [class.active]="activeCategory === 'all'"
                (click)="setCategory('all')">
                Todos los productos
              </button>

              @for (c of categories; track c.id) {
                <button class="btn btn-sm btn-outline-light"
                  [class.active]="activeCategory === c.id"
                  (click)="setCategory(c.id)">
                  {{ c.name }}
                </button>
              }
            </div>
          </div>

          <!-- Imagen / carrusel -->
          <div class="mt-4 mt-lg-0 flex-shrink-0" style="width:320px;">
            <div class="bg-black rounded-4 p-2 border border-dark">
              <div id="homeCarousel" class="carousel slide" data-bs-ride="carousel">
                
                <div class="carousel-indicators">
                  @for (s of carouselSlides; let i = $index; track i) {
                    <button type="button"
                      data-bs-target="#homeCarousel"
                      [attr.data-bs-slide-to]="i"
                      [class.active]="i === 0">
                    </button>
                  }
                </div>

                <div class="carousel-inner rounded-3 overflow-hidden">
                  @for (s of carouselSlides; let i = $index; track i) {
                    <div class="carousel-item" [class.active]="i === 0">
                      <img [src]="getImg(s)" class="d-block w-100" [alt]="getName(s)">
                      <div class="carousel-caption text-start bg-dark bg-opacity-75 rounded-3 p-2">
                        <div class="small text-white">{{ getName(s) }}</div>
                        <div class="fw-bold text-danger">
                          {{ getPrice(s) | currency:'ARS':'symbol-narrow':'1.0-0':'es-AR' }}
                        </div>
                      </div>
                    </div>
                  }
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- NOVEDADES -->
    <div class="mb-4">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h5 fw-bold text-black">Novedades</h2>
        <a routerLink="/novedades" class="small text-danger text-decoration-none">Ver todas</a>
      </div>

      <div class="row g-3">
        @for (p of products; let i = $index; track p.id ?? i) {
          @if (p.badge === 'NUEVO') {
            <div class="col-6 col-md-4 col-lg-3">
              <div class="card h-100 border-0 shadow-sm rounded-3">
                <img [src]="getImg(p)" class="card-img-top" style="object-fit:cover;height:190px;">
                <div class="card-body p-2 d-flex flex-column">
                  <span class="badge text-white mb-1" style="background:#e60000;">Nuevo</span>
                  <div class="small mb-1" style="min-height:2.5em;">
                    {{ getName(p) }}
                  </div>
                  <div class="mt-auto">
                    <div class="fw-bold fs-5 text-danger">
                      {{ getPrice(p) | currency:'ARS':'symbol-narrow':'1.0-0':'es-AR' }}
                    </div>
                    <button class="btn btn-sm text-white w-100 mt-2" style="background:#e60000;"
                      (click)="addToCart(p)">
                      Agregar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          }
        }

        @if (!hasNovedades()) {
          <div class="col-12">
            <div class="text-muted small">No hay novedades por el momento.</div>
          </div>
        }
      </div>
    </div>

    <!-- DESTACADOS -->
    <div class="mb-4">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h5 fw-bold text-black">Destacados</h2>
        <a routerLink="/productos" class="small text-danger text-decoration-none">Ver más</a>
      </div>

      <div class="row g-3">
        @for (p of filteredProducts; let i = $index; track p.id ?? i) {
          <div class="col-6 col-md-4 col-lg-3">
            <div class="card h-100 border-0 shadow-sm rounded-3">
              <div class="position-relative">
                <img [src]="getImg(p)" class="card-img-top" style="object-fit:cover;height:190px;">
                @if (p.badge) {
                  <span class="badge bg-warning text-dark position-absolute m-2">{{ p.badge }}</span>
                }
              </div>

              <div class="card-body p-2 d-flex flex-column">
                <div class="small mb-1" style="min-height:2.5em;">
                  {{ getName(p) }}
                </div>
                <div class="mt-auto">
                  <div class="fw-bold fs-5 text-danger">
                    {{ getPrice(p) | currency:'ARS':'symbol-narrow':'1.0-0':'es-AR' }}
                  </div>
                  <button class="btn btn-sm w-100 mt-2 text-white" style="background:#000;"
                    (click)="addToCart(p)">
                    Agregar
                  </button>
                </div>
              </div>
            </div>
          </div>
        }

        @if (!filteredProducts.length) {
          <div class="col-12">
            <div class="text-muted small">No hay productos para la búsqueda/filtrado.</div>
          </div>
        }
      </div>
    </div>

    <!-- MARCAS -->
    <div class="mb-5">
      <h2 class="h6 fw-bold mb-2 text-black">Marcas</h2>

      <div class="bg-white rounded-3 p-3 border">
        @if (marcas.length) {
          <div class="d-flex flex-wrap gap-2">
            @for (m of marcas; track m.id ?? m.idMarca ?? m) {
              <button class="btn btn-sm btn-outline-dark"
                [class.active]="selectedMarcaId == (m.id ?? m.idMarca ?? m)"
                (click)="setBrand(m.id ?? m.idMarca ?? m)">
                {{ m.nombre ?? m.name ?? m.titulo ?? m.texto ?? m.id }}
              </button>
            }
          </div>
        } @else {
          <div class="text-muted small">No hay marcas cargadas.</div>
        }
      </div>
    </div>

    <!-- CATEGORÍAS -->
    <div class="mb-5">
      <h2 class="h6 fw-bold mb-2 text-black">Categorías</h2>

      <div class="bg-white rounded-3 p-3 border">
        @if (categorias.length) {
          <div class="d-flex flex-wrap gap-2">
            @for (c of categorias; track c.id ?? c.idCategoria ?? c) {
              <button class="btn btn-sm btn-outline-dark"
                (click)="setCategory(c.id ?? c.idCategoria ?? 'all')">
                {{ c.nombre ?? c.name ?? c.titulo ?? c.texto ?? c.id }}
              </button>
            }
          </div>
        } @else {
          <div class="text-muted small">No hay categorías cargadas.</div>
        }
      </div>
    </div>

    <!-- CTA -->
    <div class="py-5 text-center bg-black text-white rounded-4">
      <h3 class="mb-2">¿Necesitás asesoramiento técnico?</h3>
      <p class="text-white-50 mb-4">Enviá tu consulta con número de chasis o foto real de la pieza.</p>
      <a routerLink="/contacto" class="btn text-white px-4 py-2" style="background:#e60000;">
        Contactar ahora
      </a>
    </div>

  </div>
</section>
