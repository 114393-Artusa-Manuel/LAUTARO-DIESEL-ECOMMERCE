<div class="container py-4">
  <h4>Dashboard de Pagos</h4>

  <div class="mb-3 d-flex gap-2 align-items-center">
    <input class="form-control form-control-sm" placeholder="Buscar por orderId, status, email..." [(ngModel)]="filter" (ngModelChange)="applyFilter()" />
    <button class="btn btn-sm btn-outline-secondary" type="button" (click)="loadPayments()">Refrescar</button>
  </div>

  <div *ngIf="message" class="alert alert-warning">{{ message }}</div>

  <div *ngIf="loading" class="text-center py-3">
    <div class="spinner-border spinner-border-sm"></div>
  </div>

  <table *ngIf="!loading" class="table table-sm table-striped">
    <thead>
      <tr>
        <th>OrderId</th>
        <th>PreferenceId</th>
        <th>PaymentId</th>
        <th>Status</th>
        <th>Metodo</th>
        <th>Monto</th>
        <th>Email</th>
        <th>Fecha</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of payments">
        <td>{{ p.orderId ?? p.order_id ?? p.order }}</td>
        <td>{{ p.preferenceId }}</td>
        <td>{{ p.paymentId }}</td>
        <td>{{ p.status }}</td>
        <td>{{ p.paymentMethod }}</td>
        <td>{{ p.amount }}</td>
        <td>{{ p.payerEmail }}</td>
        <td>{{ p.dateCreated || p.date_created || p.dateApproved }}</td>
        <td><button class="btn btn-sm btn-outline-primary" (click)="select(p)">Ver</button></td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="selected" class="card mt-3 p-3">
    <h5>Detalle pago â€” {{ selected.orderId ?? selected.order }}</h5>
    <pre style="max-height:300px;overflow:auto;background:#f8f9fa;padding:12px;border-radius:6px">{{ selected | json }}</pre>
    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-secondary" type="button" (click)="closeDetail()">Cerrar</button>
      <button class="btn btn-sm btn-outline-success" type="button" (click)="loadPayments()">Refrescar lista</button>
    </div>
  </div>
</div>
