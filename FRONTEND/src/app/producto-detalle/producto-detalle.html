<div class="container py-4">
  <button class="btn btn-link mb-3" (click)="goBack()">&larr; Volver</button>

  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div>
  </div>

  <div *ngIf="message" class="alert alert-warning">{{ message }}</div>

  <div *ngIf="product" class="row g-3">
    <div class="col-12 col-md-6">

      <!-- Carrusel de imágenes -->
      <div *ngIf="imagenes.length > 0; else sinImagen" id="carouselProducto" class="carousel slide">
        <div class="carousel-inner">
          <div *ngFor="let img of imagenes; let i = index" [ngClass]="{'active': i === 0}" class="carousel-item">
            <img [src]="img.url" class="d-block w-100 rounded sombra" [alt]="img.textoAlt || 'Imagen del producto'">
          </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselProducto" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselProducto" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>

      <!-- Placeholder si no hay imágenes -->
      <ng-template #sinImagen>
        <div class="placeholder-img bg-light d-flex align-items-center justify-content-center">
          <span class="text-muted">Sin imágenes disponibles</span>
        </div>
      </ng-template>
    </div>

    <div class="col-12 col-md-6">
      <h3>{{ product.nombre }}</h3>
      <p class="text-muted">{{ product.descripcion }}</p>

      <div class="mb-3">
        <strong *ngIf="product.precio != null">{{ product.precio | number:'1.2-2' }} {{ product.moneda || '' }}</strong>
        <span *ngIf="product.precio == null" class="text-muted">Precio no disponible</span>
      </div>

      <div class="mb-3">
        <label class="form-label">Cantidad</label>
        <input type="number" class="form-control" [(ngModel)]="qty" min="1" />
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary" (click)="addToCart()">Agregar al carrito</button>
        <a class="btn btn-outline-secondary" routerLink="/productos">Seguir comprando</a>
      </div>
    </div>
  </div>
  
  <div *ngIf="message && !product" class="mt-3">
    <button *ngIf="currentId" class="btn btn-outline-primary me-2" (click)="loadProduct(currentId)">Reintentar</button>
    <a class="btn btn-link" routerLink="/productos">Volver a productos</a>
  </div>
</div>
